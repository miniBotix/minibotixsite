<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniBotix Â· Components Shop</title>
  <meta name="description" content="MiniBotix Components Shop â€” quality electronics components for agriculture & engineering" />
  <link rel="icon" href="file.svg" type="image/svg+xml">

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------------- global ---------------- */
    :root{
      --bg-900:#071226;
      --bg-800:#041022;
      --card:#0b1220;
      --muted: rgba(255,255,255,0.75);
      --glass: rgba(255,255,255,0.03);
      --accent-1: #0ea5ff;
      --accent-2: #0066ff;
      --accent-grad: linear-gradient(90deg,var(--accent-2),var(--accent-1));
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg-900),#041224);color:#fff;overflow-x:hidden}
    a{color:inherit;text-decoration:none}

    /* ---------------- top nav ---------------- */
    header.site-nav{
      position:fixed;top:0;left:0;right:0;height:68px;display:flex;align-items:center;justify-content:space-between;padding:0 26px;
      background:rgba(2,6,12,0.45);backdrop-filter:blur(6px);z-index:80;border-bottom:1px solid rgba(255,255,255,0.03)
    }
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:42px;height:42px;border-radius:8px;object-fit:cover}
    .brand .title{font-weight:700;font-size:18px;letter-spacing:0.2px}
    nav.main-links{display:flex;gap:20px;align-items:center}
    nav.main-links a{padding:8px 10px;border-radius:8px;font-weight:500;color:rgba(255,255,255,0.9);transition:all .18s}
    nav.main-links a:hover{color:var(--accent-1);transform:translateY(-3px)}

    .right-controls{display:flex;align-items:center;gap:12px}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:#dfeaf5;cursor:pointer}
    .btn-primary{padding:9px 14px;border-radius:999px;border:none;color:#fff;background:var(--accent-grad);cursor:pointer;box-shadow:0 10px 30px rgba(2,8,25,.6)}

    /* profile pill */
    .profile-pill{display:flex;align-items:center;gap:8px;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:999px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
    .profile-pill img{width:34px;height:34px;border-radius:50%;object-fit:cover;background:#223}

    /* back button */
    .back-btn{display:flex;align-items:center;gap:8px;color:#fff;background:transparent;border:0;cursor:pointer;padding:8px 10px;border-radius:8px}
    .back-btn:hover{color:var(--accent-1)}

    /* ---------------- hero ---------------- */
    .hero{
      min-height:42vh;display:flex;align-items:center;justify-content:center;padding:110px 28px 40px 28px
    }
    .hero-card{
      width:min(1100px,96%);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:34px;border-radius:14px;backdrop-filter:blur(6px);box-shadow:0 40px 80px rgba(2,8,20,0.6)
    }
    .eyebrow{display:inline-block;background:rgba(255,255,255,0.02);padding:6px 12px;border-radius:999px;margin-bottom:12px;color:#bfeaff;font-weight:600}
    .hero h1{font-size:44px;margin:6px 0 12px;letter-spacing:0.8px}
    .hero p{color:rgba(255,255,255,0.85);margin-bottom:18px;max-width:900px;margin-left:auto;margin-right:auto}

    .hero-actions{display:flex;gap:12px;justify-content:center}
    .hero-actions .btn-primary{min-width:160px}

    /* subtle animated underline */
    .hero h1{position:relative}
    .hero h1:after{content:"";height:6px;width:70px;display:block;background:linear-gradient(90deg,#00c6ff,#0066ff);opacity:.08;border-radius:4px;position:absolute;left:50%;transform:translateX(-50%);bottom:-18px}

    /* ---------------- layout ---------------- */
    .section{padding:56px 28px}
    .container{max-width:1150px;margin:0 auto}

    .section h2{font-size:22px;margin-bottom:8px}
    .section p.lead{color:rgba(255,255,255,0.78);margin-bottom:18px}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;margin-top:18px}

    /* product card */
    .product{
      background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.02));
      padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);transition:transform .28s cubic-bezier(.2,.9,.2,1),box-shadow .28s;overflow:hidden;
      display:flex;flex-direction:column;height:100%;
    }
    .product:hover{transform:translateY(-10px);box-shadow:0 30px 60px rgba(2,8,20,0.6)}
    .p-media{height:140px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.01),rgba(255,255,255,0.02));display:flex;align-items:center;justify-content:center;overflow:hidden}
    .p-media img{max-width:100%;max-height:100%;object-fit:contain}
    .p-body{padding-top:12px;flex:1;display:flex;flex-direction:column}
    .p-title{font-size:16px;font-weight:700;margin-bottom:6px}
    .p-desc{font-size:13px;color:rgba(255,255,255,0.75);flex:1}
    .p-meta{display:flex;align-items:center;justify-content:space-between;margin-top:12px;gap:8px}
    .price{font-weight:800;color:#8ef;letter-spacing:0.4px}
    .p-actions{display:flex;gap:8px;margin-top:8px}
    .btn-add{flex:1;padding:9px;border-radius:10px;border:0;background:var(--accent-grad);color:#fff;font-weight:700;cursor:pointer}
    .btn-wish{padding:9px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;cursor:pointer}

    /* floating cart drawer */
    .cart-drawer{
      position:fixed;right:26px;bottom:26px;width:380px;max-height:70vh;background:linear-gradient(180deg,rgba(8,12,24,0.98),rgba(10,14,30,0.98));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 80px rgba(2,8,20,0.6);z-index:120;display:flex;flex-direction:column;gap:10px
    }
    .cart-header{display:flex;align-items:center;justify-content:space-between}
    .cart-list{overflow:auto;max-height:48vh;padding-right:6px}
    .cart-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
    .cart-item img{width:56px;height:48px;object-fit:contain;border-radius:6px}
    .cart-item .meta{flex:1}
    .cart-item .meta .name{font-weight:700;font-size:14px}
    .cart-item .meta .qty{font-size:13px;color:rgba(255,255,255,0.7)}
    .cart-footer{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:6px}
    .place-btn{background:linear-gradient(90deg,#06b6d4,#0b84ff);padding:10px 14px;border-radius:8px;border:0;color:#021;font-weight:800;cursor:pointer}

    /* footer */
    footer.site-foot{text-align:center;padding:26px 20px;color:rgba(255,255,255,0.6);margin-top:36px}
    footer .brandline{font-weight:700;margin-bottom:6px}

    /* responsive */
    @media(max-width:880px){
      .cart-drawer{right:10px;left:10px;width:auto;bottom:10px}
      .hero h1{font-size:28px}
      .p-media{height:120px}
    }
  </style>
</head>
<body>
  <!-- top nav -->
  <header class="site-nav" role="banner">
    <div style="display:flex;align-items:center;gap:16px">
      <button class="back-btn" id="backBtn" title="Back to Home">â¬… Back</button>
      <div class="brand">
        <img src="file.svg" alt="MiniBotix logo" loading="lazy">
        <div>
          <div class="title">MiniBotix</div>
          <div style="font-size:12px;color:rgba(255,255,255,0.55)">Components Shop</div>
        </div>
      </div>
    </div>

    <nav class="main-links" aria-label="Main">
      <a href="index.html">Home</a>
      <a href="courses.html">Courses</a>
      <a href="products.html">Products</a>
      <a href="componentshop.html" style="text-decoration:underline">Components</a>
      <a href="projects.html">Projects</a>
      <a href="apps.html">Free Apps</a>
      <a href="contact.html">Contact</a>
    </nav>

    <div class="right-controls">
      <div id="signedOutUI">
        <button id="openAuth" class="btn-ghost">Sign In</button>
      </div>

      <div id="signedInUI" class="profile-pill" style="display:none" title="Profile">
        <img id="profileAvatar" src="file.svg" alt="profile">
        <div id="profileName">User</div>
      </div>

      <button id="openCartFloating" class="btn-ghost" title="Open Cart">ðŸ›’ <span id="cartCount" style="margin-left:6px">0</span></button>
    </div>
  </header>

  <!-- hero -->
  <section class="hero" id="hero">
    <div class="hero-card container">
      <div class="eyebrow">MiniBotix Â· Components Â· Quality Parts</div>
      <h1>Quality Components â€” Low Cost, High Reliability</h1>
      <p>Browse our curated selection of electronics components for agriculture and engineering projects. Add to cart and place an order â€” we deliver and support you along the way.</p>
      <div class="hero-actions">
        <button id="toProductsBtn" class="btn-primary">Shop All Components</button>
        <button id="contactBtn" class="btn-ghost">Contact Support</button>
      </div>
    </div>
  </section>

  <!-- products grid -->
  <section class="section">
    <div class="container">
      <h2>Available Components</h2>
      <p class="lead">Click Add to Cart to collect parts. We persist your cart to your account so it follows you across pages.</p>

      <div class="grid" id="productGrid" aria-live="polite"></div>
    </div>
  </section>

  <!-- floating cart -->
  <div id="cartDrawer" class="cart-drawer" style="display:none">
    <div class="cart-header">
      <div style="font-weight:800">Your Cart</div>
      <div id="cartClose" style="opacity:0.8;cursor:pointer">âœ•</div>
    </div>
    <div id="cartList" class="cart-list"></div>
    <div class="cart-footer">
      <div style="font-weight:700">Total: <span id="cartTotal">â‚¹0</span></div>
      <div style="display:flex;gap:8px">
        <button id="clearCart" class="btn-wish" style="background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px">Clear</button>
        <button id="placeOrder" class="place-btn">Place Order</button>
      </div>
    </div>
    <div style="font-size:12px;color:rgba(255,255,255,0.55);margin-top:8px">Powered by MiniBotix</div>
  </div>

  <!-- footer -->
  <footer class="site-foot">
    <div class="container">
      <div class="brandline">MiniBotix Â· Learn Â· Build Â· Innovate</div>
      <div style="font-size:13px;color:rgba(255,255,255,0.55)">Â© 2025 MiniBotix</div>
    </div>
  </footer>

  <!-- Firebase + app script -->
  <script type="module">
    // Firebase v12 modular SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      collection,
      addDoc,
      getDocs,
      updateDoc,
      query,
      where,
      orderBy,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    // ---------- CONFIG ----------
    const firebaseConfig = {
      apiKey: "AIzaSyDWmliHHP7UR1pmM6CNjY6o_NvF-hYJWpY",
      authDomain: "minibotix-a1b9a.firebaseapp.com",
      projectId: "minibotix-a1b9a",
      storageBucket: "minibotix-a1b9a.firebasestorage.app",
      messagingSenderId: "771169717230",
      appId: "1:771169717230:web:44848d73e548d0e0f8dcff",
      measurementId: "G-JQKFSBN4WP"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();

    // ---------- UI refs ----------
    const backBtn = document.getElementById('backBtn');
    const productGrid = document.getElementById('productGrid');
    const cartDrawer = document.getElementById('cartDrawer');
    const openCartFloating = document.getElementById('openCartFloating');
    const cartClose = document.getElementById('cartClose');
    const cartList = document.getElementById('cartList');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartCount = document.getElementById('cartCount');
    const placeOrderBtn = document.getElementById('placeOrder');
    const clearCartBtn = document.getElementById('clearCart');

    const signedOutUI = document.getElementById('signedOutUI');
    const signedInUI = document.getElementById('signedInUI');
    const openAuth = document.getElementById('openAuth');
    const profileAvatar = document.getElementById('profileAvatar');
    const profileName = document.getElementById('profileName');

    // hero buttons
    document.getElementById('toProductsBtn').addEventListener('click', ()=>{ window.scrollTo({top: document.querySelector('#productGrid').offsetTop - 80, behavior:'smooth'}); });
    document.getElementById('contactBtn').addEventListener('click', ()=>{ window.location.href = 'contact.html'; });

    // back button to home
    backBtn.addEventListener('click', ()=>{ window.location.href = 'index.html'; });

    // cart state
    let productList = [];   // loaded from products.json
    let cart = [];          // in-memory
    let currentUser = null; // firebase user

    // load products.json and render
    async function loadProducts(){
      try{
        const res = await fetch('products.json', {cache: "no-store"});
        if(!res.ok) throw new Error('products.json not found');
        productList = await res.json();
        renderProducts();
      }catch(e){
        console.error('Load products failed', e);
        productGrid.innerHTML = `<div style="grid-column:1/-1;padding:24px;background:rgba(255,255,255,0.02);border-radius:8px">Unable to load products.json â€” make sure file exists in the same repo. Error: ${e.message}</div>`;
      }
    }

    function renderProducts(){
      productGrid.innerHTML = '';
      productList.forEach((p, idx)=>{
        const el = document.createElement('article');
        el.className = 'product';
        el.innerHTML = `
          <div class="p-media"><img src="${escapeHtml(p.image||'file.svg')}" alt="${escapeHtml(p.name)}"></div>
          <div class="p-body">
            <div class="p-title">${escapeHtml(p.name)}</div>
            <div class="p-desc">${escapeHtml(p.description||'')}</div>
            <div class="p-meta">
              <div class="price">â‚¹${Number(p.price).toLocaleString()}</div>
              <div style="display:flex;gap:8px">
                <button class="btn-wish" data-idx="${idx}" title="View details">Details</button>
                <button class="btn-add" data-idx="${idx}" title="Add to cart">Add to Cart</button>
              </div>
            </div>
          </div>
        `;
        productGrid.appendChild(el);
      });

      // attach events
      productGrid.querySelectorAll('.btn-add').forEach(btn=>{
        btn.addEventListener('click', (ev)=>{
          const idx = Number(btn.getAttribute('data-idx'));
          addToCart(idx);
        });
      });
      productGrid.querySelectorAll('.btn-wish').forEach(btn=>{
        btn.addEventListener('click', (ev)=>{
          const idx = Number(btn.getAttribute('data-idx'));
          // basic modal or quick view - here we just alert
          const p = productList[idx];
          alert(`${p.name}\n\nPrice: â‚¹${p.price}\n\n${p.description}`);
        });
      });
    }

    // add to cart (UI + Firestore)
    async function addToCart(idx){
      const p = productList[idx];
      if(!p) return;
      // add to in-memory cart
      const existing = cart.find(c=>c.id === p.id);
      if(existing) existing.qty += 1;
      else cart.push({ id: p.id, name: p.name, price: Number(p.price), image: p.image, qty: 1 });

      renderCartUI();

      // save cart to firestore under user -> cart collection (if logged in)
      if(currentUser){
        try{
          // simple approach: save snapshot of cart as a doc (userCart) â€” overwrite
          const userCartRef = doc(db, 'users', currentUser.uid, 'meta', 'cartSnapshot');
          await setDoc(userCartRef, { totalItems: cart.reduce((s,i)=>s+i.qty,0), updatedAt: serverTimestamp(), cart });
        }catch(e){ console.warn('Save cart failed', e); }
      } else {
        // persist locally for anonymous
        localStorage.setItem('mb_cart', JSON.stringify(cart));
      }
    }

    function renderCartUI(){
      cartList.innerHTML = '';
      let total = 0;
      cart.forEach(item=>{
        total += item.price * item.qty;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <img src="${escapeHtml(item.image||'file.svg')}" alt="${escapeHtml(item.name)}">
          <div class="meta">
            <div class="name">${escapeHtml(item.name)}</div>
            <div class="qty">Qty: ${item.qty} Â· â‚¹${(item.price*item.qty).toLocaleString()}</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button class="btn-wish" data-id="${escapeHtml(item.id)}" style="padding:6px 8px;border-radius:8px">âˆ’</button>
            <button class="btn-wish" data-id-add="${escapeHtml(item.id)}" style="padding:6px 8px;border-radius:8px">+</button>
          </div>
        `;
        cartList.appendChild(div);
      });
      cartTotalEl.textContent = `â‚¹${total.toLocaleString()}`;
      cartCount.textContent = cart.reduce((s,i)=>s+i.qty,0);
      // attach +/- handlers
      cartList.querySelectorAll('[data-id]').forEach(b=>{
        b.addEventListener('click', ()=>{ changeQty(b.getAttribute('data-id'), -1); });
      });
      cartList.querySelectorAll('[data-id-add]').forEach(b=>{
        b.addEventListener('click', ()=>{ changeQty(b.getAttribute('data-id-add'), +1); });
      });
    }

    function changeQty(id, delta){
      const idx = cart.findIndex(c=>c.id == id);
      if(idx === -1) return;
      cart[idx].qty += delta;
      if(cart[idx].qty <= 0) cart.splice(idx,1);
      renderCartUI();
      // persist
      if(currentUser){
        setDoc(doc(db, 'users', currentUser.uid, 'meta', 'cartSnapshot'), { totalItems: cart.reduce((s,i)=>s+i.qty,0), updatedAt: serverTimestamp(), cart }).catch(e=>console.warn(e));
      } else localStorage.setItem('mb_cart', JSON.stringify(cart));
    }

    // open/close cart
    openCartFloating.addEventListener('click', ()=>{
      cartDrawer.style.display = cartDrawer.style.display === 'none' ? 'flex' : 'none';
    });
    cartClose.addEventListener('click', ()=> cartDrawer.style.display = 'none');

    // clear cart
    clearCartBtn.addEventListener('click', async ()=>{
      if(!confirm('Clear cart?')) return;
      cart = [];
      renderCartUI();
      if(currentUser){
        try{ await setDoc(doc(db, 'users', currentUser.uid, 'meta', 'cartSnapshot'), { totalItems: 0, cart: [], updatedAt: serverTimestamp() }); } catch(e){console.warn(e)}
      } else localStorage.removeItem('mb_cart');
    });

    // place order â€” stores order doc in Firestore
    placeOrderBtn.addEventListener('click', async ()=>{
      if(cart.length === 0){ alert('Cart is empty'); return; }
      if(!currentUser){
        alert('Please sign in to place order');
        return;
      }
      const confirmPlace = confirm('Place order now?');
      if(!confirmPlace) return;
      // get user profile doc
      try{
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
        const userData = userDoc.exists() ? userDoc.data() : { name: currentUser.displayName || '', email: currentUser.email || '' };
        const order = {
          uid: currentUser.uid,
          userName: userData.name || '',
          userEmail: userData.email || currentUser.email,
          userPhone: userData.phone || '',
          userArea: userData.area || '',
          items: cart,
          total: cart.reduce((s,i)=>s+i.price*i.qty,0),
          createdAt: serverTimestamp(),
          status: 'pending'
        };
        const ordersRef = collection(db, 'orders');
        await addDoc(ordersRef, order);

        // optionally clear cart
        cart = [];
        renderCartUI();
        await setDoc(doc(db, 'users', currentUser.uid, 'meta', 'cartSnapshot'), { totalItems: 0, cart: [], updatedAt: serverTimestamp() });

        alert('Order placed! We will contact you soon.');
      }catch(e){
        console.error('Place order failed', e);
        alert('Order failed: ' + (e.message || e));
      }
    });

    // ---------- Auth & user persistence ----------
    // small modal-less sign in flow: popup Google or email prompt (email/password handled on index.html usually)
    openAuth.addEventListener('click', async ()=>{
      try{
        const res = await signInWithPopup(auth, googleProvider);
        // user will be handled in onAuthStateChanged
      }catch(e){
        console.error('Google sign-in failed', e);
        alert('Google sign-in failed: ' + (e.message || e));
      }
    });

    // onAuthStateChanged: load user cart snapshot & show UI
    onAuthStateChanged(auth, async (user)=>{
      if(user){
        currentUser = user;
        signedOutUI.style.display = 'none';
        signedInUI.style.display = 'flex';
        profileName.textContent = user.displayName ? user.displayName.split(' ')[0] : (user.email?user.email.split('@')[0]:'User');
        profileAvatar.src = user.photoURL || gravatarFallback(user.email);

        // read cart snapshot if any
        try{
          const snap = await getDoc(doc(db, 'users', user.uid, 'meta', 'cartSnapshot'));
          if(snap.exists()){
            const data = snap.data();
            if(Array.isArray(data.cart) && data.cart.length > 0){
              cart = data.cart;
            } else {
              // fallback to local cart if exists
              const local = localStorage.getItem('mb_cart');
              if(local) cart = JSON.parse(local);
            }
          } else {
            const local = localStorage.getItem('mb_cart');
            if(local) cart = JSON.parse(local);
            else cart = [];
          }
        }catch(e){
          console.warn('Load user cart failed', e);
          const local = localStorage.getItem('mb_cart');
          cart = local ? JSON.parse(local) : [];
        }

        renderCartUI();
      } else {
        currentUser = null;
        signedOutUI.style.display = 'flex';
        signedInUI.style.display = 'none';
        // try load local
        const local = localStorage.getItem('mb_cart');
        cart = local ? JSON.parse(local) : [];
        renderCartUI();
      }
    });

    // helper: gravatar fallback (md5)
    function gravatarFallback(email){
      if(!email) return 'file.svg';
      const hash = md5((email||'').trim().toLowerCase());
      return `https://www.gravatar.com/avatar/${hash}?d=identicon&s=80`;
    }

    // small MD5 (same compact) for gravatar
    function md5(s){
      function L(k,d){return (k<<d)|(k>>>(32-d))}
      function K(G,k){var I=(G&65535)+(k&65535);var H=(G>>>16)+(k>>>16)+(I>>>16);return (H<<16)|(I&65535)}
      function r(a,b,c,d,e,f,g){a=K(a,K(K((b&c)|((~b)&d),e),g));return K(L(a,f),b)}
      function o(a,b,c,d,e,f,g){a=K(a,K(K((b&d)|(c&(~d)),e),g));return K(L(a,f),b)}
      function q(a,b,c,d,e,f,g){a=K(a,K(K(b^c^d,e),g));return K(L(a,f),b)}
      function p(a,b,c,d,e,f,g){a=K(a,K(K(c^(b|(~d)),e),g));return K(L(a,f),b)}
      function s(s){var n=[],b=(1<<8)-1;for(var i=0;i<s.length*8;i+=8)n[i>>5]|=(s.charCodeAt(i/8)&b)<<(i%32);return n}
      function t(l){var a='',b=32;for(var i=0;i<4;i++)for(var j=0;j<8;j++){a+=((l>>>(i*8+j*4))&15).toString(16)}return a}
      var x=s(unescape(encodeURIComponent(s||'')));
      var a=1732584193,b=-271733879,c=-1732584194,d=271733878;
      x[x.length>>0]=x.length*8;
      for(var i=0;i<x.length;i+=16){
        var olda=a,oldb=b,oldc=c,oldd=d;
        a=r(a,b,c,d,x[i+0],7,-680876936);d=r(d,a,b,c,x[i+1],12,-389564586);
        c=r(c,d,a,b,x[i+2],17,606105819);b=r(b,c,d,a,x[i+3],22,-1044525330);
        a=r(a,b,c,d,x[i+4],7,-176418897);d=r(d,a,b,c,x[i+5],12,1200080426);
        c=r(c,d,a,b,x[i+6],17,-1473231341);b=r(b,c,d,a,x[i+7],22,-45705983);
        a=r(a,b,c,d,x[i+8],7,1770035416);d=r(d,a,b,c,x[i+9],12,-1958414417);
        c=r(c,d,a,b,x[i+10],17,-42063);b=r(b,c,d,a,x[i+11],22,-1990404162);
        a=r(a,b,c,d,x[i+12],7,1804603682);d=r(d,a,b,c,x[i+13],12,-40341101);
        c=r(c,d,a,b,x[i+14],17,-1502002290);b=r(b,c,d,a,x[i+15],22,1236535329);
        a=o(a,b,c,d,x[i+1],5,-165796510);d=o(d,a,b,c,x[i+6],9,-1069501632);
        c=o(c,d,a,b,x[i+11],14,643717713);b=o(b,c,d,a,x[i+0],20,-373897302);
        a=o(a,b,c,d,x[i+5],5,-701558691);d=o(d,a,b,c,x[i+10],9,38016083);
        c=o(c,d,a,b,x[i+15],14,-660478335);b=o(b,c,d,a,x[i+4],20,-405537848);
        a=o(a,b,c,d,x[i+9],5,568446438);d=o(d,a,b,c,x[i+14],9,-1019803690);
        c=o(c,d,a,b,x[i+3],14,-187363961);b=o(b,c,d,a,x[i+8],20,1163531501);
        a=o(a,b,c,d,x[i+13],5,-1444681467);d=o(d,a,b,c,x[i+2],9,-51403784);
        c=o(c,d,a,b,x[i+7],14,1735328473);b=o(b,c,d,a,x[i+12],20,-1926607734);
        a=q(a,b,c,d,x[i+5],4,-378558);d=q(d,a,b,c,x[i+8],11,-2022574463);
        c=q(c,d,a,b,x[i+11],16,1839030562);b=q(b,c,d,a,x[i+14],23,-35309556);
        a=q(a,b,c,d,x[i+1],4,-1530992060);d=q(d,a,b,c,x[i+4],11,1272893353);
        c=q(c,d,a,b,x[i+7],16,-155497632);b=q(b,c,d,a,x[i+10],23,-1094730640);
        a=q(a,b,c,d,x[i+13],4,681279174);d=q(d,a,b,c,x[i+0],11,-358537222);
        c=q(c,d,a,b,x[i+3],16,-722521979);b=q(b,c,d,a,x[i+6],23,76029189);
        a=q(a,b,c,d,x[i+9],4,-640364487);d=q(d,a,b,c,x[i+12],11,-421815835);
        c=q(c,d,a,b,x[i+15],16,530742520);b=q(b,c,d,a,x[i+2],23,-995338651);
        a=p(a,b,c,d,x[i+0],6,-198630844);d=p(d,a,b,c,x[i+7],10,1126891415);
        c=p(c,d,a,b,x[i+14],15,-1416354905);b=p(b,c,d,a,x[i+5],21,-57434055);
        a=p(a,b,c,d,x[i+12],6,1700485571);d=p(d,a,b,c,x[i+3],10,-1894986606);
        c=p(c,d,a,b,x[i+10],15,-1051523);b=p(b,c,d,a,x[i+1],21,-2054922799);
        a=p(a,b,c,d,x[i+8],6,1873313359);d=p(d,a,b,c,x[i+15],10,-30611744);
        c=p(c,d,a,b,x[i+6],15,-1560198380);b=p(b,c,d,a,x[i+13],21,1309151649);
        a=p(a,b,c,d,x[i+4],6,-145523070);d=p(d,a,b,c,x[i+11],10,-1120210379);
        c=p(c,d,a,b,x[i+2],15,718787259);b=p(b,c,d,a,x[i+9],21,-343485551);
        a=K(a,olda);b=K(b,oldb);c=K(c,oldc);d=K(d,oldd);
      }
      function toHex(n){return ('00000000'+(n>>>0).toString(16)).slice(-8)}
      return toHex(a)+toHex(b)+toHex(c)+toHex(d);
    }

    // small util: escape text for innerHTML injection
    function escapeHtml(s){
      if(!s) return '';
      return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    // init
    loadProducts();

    // small diagnostic in console
    console.log('MiniBotix componentshop loaded. origin:', location.origin, 'project:', app.options.projectId);

  </script>
</body>
</html>
