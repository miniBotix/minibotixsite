<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="MiniBotix - Courses, Products (Agriculture & Engineering), Electronics Components, Projects & Free Source Code" />
  <title>MiniBotix · Learn · Build · Innovate</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
  <!-- tsparticles for particles -->
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@3.8.1/tsparticles.bundle.min.js" defer></script>

  <style>
    :root{
      --accent-start:#00a8ff;
      --accent-end:#00e0ff;
      --bg-dark:#071226;
      --card-bg: rgba(255,255,255,0.04);
      --glass: rgba(255,255,255,0.03);
      --muted: rgba(255,255,255,0.75);
      --success: #00c2ff;
      --danger: #ff5a5a;
    }

    /* Basic reset */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial;color:#fff;background:#071226;overflow-x:hidden;scroll-behavior:smooth}
    a{color:inherit;text-decoration:none}

    /* Full-screen background - background.jpg (place in root) */
    body::before{
      content:"";
      position:fixed;inset:0;
      background: center/cover no-repeat url('background.jpg');
      filter: contrast(1.02) saturate(1.05) brightness(0.85);
      transform: translateZ(0);
      z-index:-40;
      transition: transform .18s linear;
      will-change: transform;
    }
    /* subtle gradient overlay */
    .bg-overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(2,6,12,0.48),rgba(2,6,12,0.36));z-index:-30;pointer-events:none}

    /* canvas for particles */
    #particlesCanvas{position:fixed;inset:0;z-index:-20;pointer-events:none;opacity:0.82}

    /* header */
    header.nav{
      position:fixed;top:0;left:0;right:0;height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 26px;
      background:linear-gradient(180deg, rgba(2,8,18,0.28), rgba(2,8,18,0.10));
      backdrop-filter: blur(6px);z-index:60;border-bottom:1px solid rgba(255,255,255,0.03)
    }
    .nav-left{display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;font-size:20px;color:#fff}
    .brand img{height:36px;width:36px;object-fit:contain;border-radius:8px;background:linear-gradient(90deg,var(--accent-start),var(--accent-end));padding:6px}
    nav.main-nav{display:flex;gap:18px;align-items:center}
    nav.main-nav a{font-weight:600;color:rgba(255,255,255,0.92);padding:6px 8px;border-radius:6px;transition:all .18s}
    nav.main-nav a:hover{transform:translateY(-3px);color:var(--accent-end)}
    .user-area{display:flex;align-items:center;gap:12px}

    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent-start),var(--accent-end));padding:10px 16px;border-radius:30px;border:none;color:#021;font-weight:700;cursor:pointer;box-shadow:0 12px 40px rgba(0,0,0,.45)}

    .hamburger{display:none;width:46px;height:46px;border-radius:10px;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:transform .25s}
    .hamburger.open{transform:rotate(90deg)}
    .hamburger div{width:24px;height:2px;background:#fff;border-radius:2px;position:relative}
    .hamburger div:after,.hamburger div:before{content:'';position:absolute;width:24px;height:2px;background:#fff;border-radius:2px;left:0}
    .hamburger div:before{top:-8px} .hamburger div:after{top:8px}

    /* hero */
    .hero{min-height:86vh;display:flex;align-items:center;justify-content:center;padding:120px 18px 80px 18px;text-align:center;position:relative}
    .hero-card{width:min(1080px,96%);background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));padding:48px;border-radius:16px;backdrop-filter: blur(8px);box-shadow:0 30px 80px rgba(3,7,20,.6);position:relative;overflow:hidden}
    .eyebrow{display:inline-block;background:rgba(0,0,0,0.24);padding:8px 12px;border-radius:999px;margin-bottom:16px;font-weight:700;color:var(--accent-end);letter-spacing:0.6px}
    .hero h1{font-size:56px;line-height:1.03;margin-bottom:14px;letter-spacing:0.6px}
    .hero p{color:rgba(255,255,255,0.88);margin-bottom:22px;font-size:16px}
    .hero-actions{display:flex;gap:16px;justify-content:center;flex-wrap:wrap}

    /* sections */
    .section{padding:64px 22px;background:transparent}
    .container{max-width:1200px;margin:0 auto}
    .section h2{font-size:30px;color:#fff;margin-bottom:12px;text-align:center}
    .section p.lead{color:rgba(255,255,255,0.88);margin-bottom:18px;text-align:center}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:18px;margin-top:18px}
    .card{background:var(--card-bg);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);transition:transform .25s ease,box-shadow .25s;overflow:hidden}
    .card:hover{transform:translateY(-8px);box-shadow:0 18px 46px rgba(0,0,0,.5)}
    .card h3{font-size:18px;margin-bottom:8px}
    .card p{font-size:14px;color:rgba(255,255,255,0.85)}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(0,0,0,0.2);font-weight:700;font-size:12px;margin-right:8px;color:#dff}

    footer{padding:28px 22px;background:transparent;text-align:center;color:rgba(255,255,255,0.7)}

    /* auth modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:120;backdrop-filter:blur(4px)}
    .modal-card{width:100%;max-width:540px;background:linear-gradient(180deg,#071826,#081426);padding:22px;border-radius:12px;border:1px solid rgba(255,255,255,.03)}
    .modal .close{float:right;color:rgba(255,255,255,0.6);font-size:22px;cursor:pointer}
    .form-group{margin-bottom:12px}
    .form-group label{display:block;font-size:13px;margin-bottom:6px;color:rgba(255,255,255,0.9)}
    .form-group input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff}

    .small{font-size:13px;color:rgba(255,255,255,0.7)}

    /* profile pill */
    .profile-pill{display:flex;align-items:center;gap:10px;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:999px;border:1px solid rgba(255,255,255,0.03)}
    .profile-pill img{height:36px;width:36px;border-radius:50%;object-fit:cover;background:#223}

    /* dashboard */
    #dashboardSection{ display:none;padding:40px 22px; border-top:1px solid rgba(255,255,255,0.03); }
    .dashboard-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start}
    .dash-main{min-height:260px;padding:18px;border-radius:12px;background:var(--card-bg);border:1px solid rgba(255,255,255,0.03)}
    .dash-side{padding:18px;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
    .product-card img{width:100%;height:140px;object-fit:cover;border-radius:10px;margin-bottom:10px}

    /* skeleton */
    .skeleton{height:180px;border-radius:12px;background:linear-gradient(90deg,#081127,#0b1830,#081127);background-size:200% 100%;animation:skeletonLoading 1.6s infinite}
    @keyframes skeletonLoading { 0%{background-position:200% 0%} 100%{background-position:-200% 0%} }

    /* mobile nav */
    .mobile-nav { position:fixed;top:64px;right:18px;background:linear-gradient(180deg,rgba(1,6,12,0.98),rgba(3,8,16,0.98));border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px;transform-origin:top right;transform:scale(.98) translateY(-6px);opacity:0;pointer-events:none;transition:transform .22s ease,opacity .22s ease; border:1px solid rgba(255,255,255,0.03);z-index:60; }
    .mobile-nav.open { transform:scale(1) translateY(0);opacity:1;pointer-events:auto; }

    /* toast */
    .toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%);padding:10px 16px;border-radius:10px;z-index:9999;box-shadow:0 12px 40px rgba(0,0,0,.46);font-weight:700}

    @media (max-width:980px){
      nav.main-nav{display:none}
      .hamburger{display:flex}
      .dashboard-inner{grid-template-columns:1fr}
      .hero h1{font-size:34px}
      .hero-card{padding:20px}
    }

    /* small helpers */
    .muted{color:rgba(255,255,255,0.65);font-size:13px}
    .link-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:#fff}
    .vis-toggle{cursor:pointer;padding:6px;border-radius:6px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:13px}
  </style>
</head>
<body>

  <!-- Particles canvas -->
  <div id="particlesCanvas"></div>
  <div class="bg-overlay" aria-hidden="true"></div>

  <!-- NAV -->
  <header class="nav" role="banner">
    <div class="nav-left">
      <div class="brand" aria-hidden="false">
        <img src="file.svg" alt="MiniBotix logo" loading="lazy">
        <div>MiniBotix</div>
      </div>
    </div>

    <nav class="main-nav" role="navigation" aria-label="Main navigation">
      <a href="#home" data-scroll>Home</a>
      <a href="#courses" data-scroll>Courses</a>
      <a href="#products" data-scroll>Products</a>
      <a href="#components" data-scroll>Components</a>
      <a href="#projects" data-scroll>Projects</a>
      <a href="#about" data-scroll>About</a>
      <a href="#apps" data-scroll>Free Apps</a>
      <a href="#contact" data-scroll>Contact</a>
    </nav>

    <div class="user-area" id="userArea" aria-live="polite">
      <div id="signedOutUI">
        <button id="openAuth" class="btn-ghost" title="Sign in or Register">Sign In</button>
      </div>

      <div id="signedInUI" class="profile-pill" style="display:none">
        <img id="profileAvatar" src="" alt="profile" onerror="this.src='file.svg'">
        <span id="profileName">User</span>
        <span class="settings-icon" id="openProfileSettings" title="Settings">&#9881;</span>
      </div>

      <button class="hamburger" id="mobileMenuBtn" aria-label="Open menu"><div></div></button>
    </div>
  </header>

  <!-- MOBILE NAV -->
  <div id="mobileNav" class="mobile-nav" role="dialog" aria-hidden="true">
    <a href="#home" data-scroll>Home</a>
    <a href="#courses" data-scroll>Courses</a>
    <a href="#products" data-scroll>Products</a>
    <a href="#components" data-scroll>Components</a>
    <a href="#projects" data-scroll>Projects</a>
    <a href="#about" data-scroll>About</a>
    <a href="#apps" data-scroll>Free Apps</a>
    <a href="#contact" data-scroll>Contact</a>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="mobileSignIn" class="btn-ghost">Sign In</button>
      <button id="mobileSignUp" class="btn-primary">Register</button>
    </div>
  </div>

  <!-- HERO -->
  <section id="home" class="hero" tabindex="-1">
    <div class="hero-card container" role="region" aria-label="Hero">
      <div class="eyebrow">MiniBotix • Courses · Products · Projects</div>
      <h1 id="heroTitle"><span class="word w1">Learn</span> · <span class="word w2">Build</span> · <span class="word w3" style="color:var(--accent-end)">Innovate</span></h1>
      <p class="lead">Practical courses, agricultural & engineering products, tested project kits, electronic components, and free source code to start building today.</p>

      <div class="hero-actions">
        <button class="btn-primary" id="toCourses">Explore Courses</button>
        <button class="btn-ghost" id="toProducts">Shop Products</button>
      </div>

      <div style="margin-top:20px;color:rgba(255,255,255,0.75);font-size:14px">
        <small>Scroll or click a nav link to explore</small>
      </div>
    </div>
  </section>

  <!-- COURSES -->
  <section id="courses" class="section" tabindex="-1">
    <div class="container">
      <h2>Courses</h2>
      <p class="lead">From beginner embedded systems to advanced robotics — project-based learning you can finish in weeks.</p>
      <div id="coursesGrid" class="grid" aria-live="polite">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
      </div>
    </div>
  </section>

  <!-- PRODUCTS -->
  <section id="products" class="section" tabindex="-1">
    <div class="container">
      <h2>Products (Agriculture & Engineering)</h2>
      <p class="lead">We sell tested agriculture devices, sensors, and engineering kits — shipped with documentation and support.</p>
      <div id="productsGrid" class="grid">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
      </div>
    </div>
  </section>

  <!-- Components -->
  <section id="components" class="section" tabindex="-1">
    <div class="container">
      <h2>Electronic Components</h2>
      <p class="lead">Sensors, modules, microcontrollers, PCBs and more — buy parts for your classroom or lab.</p>
      <div id="componentsGrid" class="grid">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
      </div>
    </div>
  </section>

  <!-- Projects -->
  <section id="projects" class="section" tabindex="-1">
    <div class="container">
      <h2>Projects</h2>
      <p class="lead">Get full projects with code, wiring diagrams, and BOMs — or commission custom builds.</p>
      <div class="grid">
        <div class="card"><h3>Rain Detector</h3><p>Automated cover system and alerting example with code.</p><a href="projects.html">See Projects</a></div>
        <div class="card"><h3>Robotic Arm</h3><p>Image-detection guided pick-and-place demo with servo control.</p><a href="projects.html">See Projects</a></div>
        <div class="card"><h3>Satellite Simulator</h3><p>ESP32-CAM + sensors for environmental simulation & streaming.</p><a href="projects.html">See Projects</a></div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="section" tabindex="-1">
    <div class="container">
      <h2>About MiniBotix</h2>
      <p class="lead">MiniBotix combines R&D, hardware, and software to deliver robotics and smart agriculture solutions — from concept to production.</p>

      <div class="grid">
        <div class="card">
          <h3>Founder</h3>
          <p><strong>M. Kavinkumar (Kavinmayil)</strong> — Tech Innovator · Hybrid Developer · Founder of MiniBotix. Skilled in R&D, DBMS, scripting, hardware integration, production and delivery.</p>
          <p class="muted">Kavin leads product development and education initiatives focused on practical, deployable systems for makers and farmers.</p>
        </div>

        <div class="card">
          <h3>What We Offer</h3>
          <p>Source code & system apps, agriculture products & projects, electronics components, curated datasets (web-scraping on request), and hands-on courses for agriculture data management.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Apps & Free codes -->
  <section id="apps" class="section" tabindex="-1">
    <div class="container">
      <h2>Free Apps & Source Code</h2>
      <p class="lead">Download basic apps and example source to bootstrap learning. We share starter code for students.</p>
      <div class="grid">
        <div class="card"><h3>Starter Voice Assistant</h3><p>Python-based assistant template (private code available upon course purchase).</p><a href="apps.html">Open</a></div>
        <div class="card"><h3>Color Detection Example</h3><p>OpenCV example for object detection with a webcam.</p><a href="apps.html">Open</a></div>
        <div class="card"><h3>ThingSpeak Data Sender</h3><p>NodeMCU code to push environment sensor readings to ThingSpeak.</p><a href="apps.html">Open</a></div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="section" tabindex="-1">
    <div class="container">
      <h2>Contact & Support</h2>
      <p class="lead">Need help? Send PCB files to <a href="mailto:minibotix@gmail.com">minibotix@gmail.com</a> for a free review.</p>
    </div>
  </section>

  <footer>
    <div class="container">
      <small>© 2025 MiniBotix · Learn · Build · Innovate</small>
    </div>
  </footer>

  <!-- AUTH MODAL (same DOM IDs you gave) -->
  <div id="authModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <span class="close" id="authClose" title="Close">&times;</span>

      <div id="authContainer">
        <div style="display:flex;gap:8px;margin-bottom:16px;align-items:center;justify-content:center">
          <button id="tabEmail" class="btn-primary" style="padding:8px 12px">Email</button>
          <button id="tabGoogle" class="btn-ghost" style="padding:8px 12px">Google</button>
        </div>

        <div id="emailView">
          <h3 id="authTitle">Sign In / Register</h3>
          <form id="loginForm" onsubmit="return false;">
            <div class="form-group">
              <label for="loginEmail">Email</label>
              <input id="loginEmail" type="email" required placeholder="you@domain.com" autocomplete="email">
            </div>
            <div class="form-group" style="position:relative">
              <label for="loginPassword">Password</label>
              <input id="loginPassword" type="password" required placeholder="Password" autocomplete="current-password">
              <span id="toggleLoginPass" class="vis-toggle" style="position:absolute;right:8px;top:36px">Show</span>
            </div>

            <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:12px">
              <button class="btn-primary" id="emailSignIn" type="button">Sign In</button>
              <button class="btn-ghost" id="showRegister" type="button">New? Register</button>
            </div>
            <p class="small" style="margin-top:10px;color:rgba(255,255,255,0.6)">We store profile data in Firestore.</p>
          </form>
        </div>

        <div id="registerView" style="display:none">
          <h3>Create Account</h3>
          <form id="registerForm" onsubmit="return false;">
            <div class="form-group">
              <label for="regName">Full name</label>
              <input id="regName" type="text" required placeholder="Your name" autocomplete="name">
            </div>
            <div class="form-group">
              <label for="regPhone">Phone</label>
              <input id="regPhone" type="tel" required placeholder="+91 9XXXXXXXXX" autocomplete="tel">
            </div>
            <div class="form-group">
              <label for="regEmail">Email</label>
              <input id="regEmail" type="email" required placeholder="you@domain.com" autocomplete="email">
            </div>
            <div class="form-group" style="position:relative">
              <label for="regPass">Password</label>
              <input id="regPass" type="password" required placeholder="At least 6 characters" autocomplete="new-password">
              <span id="toggleRegPass" class="vis-toggle" style="position:absolute;right:8px;top:36px">Show</span>
            </div>
            <div class="form-group">
              <label for="regPass2">Confirm Password</label>
              <input id="regPass2" type="password" required placeholder="Confirm Password" autocomplete="new-password">
            </div>

            <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:12px">
              <button class="btn-primary" id="createAccount" type="button">Create Account</button>
              <button class="btn-ghost" id="showLogin" type="button">Have account? Sign in</button>
            </div>
          </form>
        </div>

        <div id="googleView" style="display:none;text-align:center;margin-top:12px">
          <p class="small" style="margin-bottom:12px;color:rgba(255,255,255,0.7)">Sign in with Google</p>
          <button id="googleSignIn" class="btn-primary" style="display:inline-flex;align-items:center;gap:8px"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="height:18px"> Sign in with Google</button>
        </div>

      </div>
    </div>
  </div>

  <!-- PROFILE SETTINGS MODAL -->
  <div id="profileModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <span class="close" id="profileClose" title="Close">&times;</span>
      <h3>Profile Settings</h3>
      <form id="profileForm" onsubmit="return false;">
        <div class="form-group"><label>Name</label><input id="pfName" type="text" required></div>
        <div class="form-group"><label>Phone</label><input id="pfPhone" type="tel" required></div>
        <div class="form-group"><label>Delivery Area</label><input id="pfArea" type="text" required></div>
        <div style="display:flex;gap:12px;margin-top:12px">
          <button class="btn-primary" id="saveProfile" type="button">Save</button>
          <button class="btn-ghost" id="logoutBtn" type="button">Logout</button>
        </div>
      </form>
    </div>
  </div>

  <!-- DASHBOARD -->
  <section id="dashboardSection">
    <div class="dashboard-inner">
      <div class="dash-main">
        <h2>Welcome to your Dashboard</h2>
        <p class="muted" id="dashWelcome">Summary & quick actions</p>
        <div style="margin-top:18px;">
          <h3>Products</h3>
          <div id="dashboardProducts" class="product-grid">
            <div class="skeleton"></div>
            <div class="skeleton"></div>
            <div class="skeleton"></div>
          </div>
        </div>
      </div>

      <aside class="dash-side">
        <h3>Your Info</h3>
        <div id="dashProfile" style="margin-top:12px">
          <div class="muted">Name</div>
          <div id="dashName" style="font-weight:700;margin-bottom:8px">—</div>
          <div class="muted">Email</div>
          <div id="dashEmail" style="font-weight:600">—</div>

          <div style="margin-top:12px">
            <button class="link-btn" id="goToOrders">Orders</button>
            <button class="link-btn" id="manageProfile" style="margin-left:8px">Manage Profile</button>
          </div>

          <div style="margin-top:16px">
            <small class="muted">Session token:</small>
            <div id="sessionTokenPreview" style="word-break:break-word;font-size:12px;margin-top:6px;color:var(--success)"></div>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- Toast container is injected by JS -->

  <!-- Firebase SDKs (modular v12) + main script (module) -->
  <script type="module">
    /* ====================
       FIREBASE SETUP (modular v12)
       Uses the config you provided earlier.
       ==================== */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      updateDoc,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    // ---------- FIREBASE CONFIG (your provided config) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyDWmliHHP7UR1pmM6CNjY6o_NvF-hYJWpY",
      authDomain: "minibotix-a1b9a.firebaseapp.com",
      projectId: "minibotix-a1b9a",
      storageBucket: "minibotix-a1b9a.firebasestorage.app",
      messagingSenderId: "771169717230",
      appId: "1:771169717230:web:44848d73e548d0e0f8dcff",
      measurementId: "G-JQKFSBN4WP"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();

    /* ====================
       DOM refs (exact IDs you gave)
       ==================== */
    const openAuth = document.getElementById('openAuth');
    const authModal = document.getElementById('authModal');
    const authClose = document.getElementById('authClose');
    const tabEmail = document.getElementById('tabEmail');
    const tabGoogle = document.getElementById('tabGoogle');
    const emailView = document.getElementById('emailView');
    const googleView = document.getElementById('googleView');
    const registerView = document.getElementById('registerView');
    const showRegister = document.getElementById('showRegister');
    const showLogin = document.getElementById('showLogin');
    const emailSignIn = document.getElementById('emailSignIn');
    const createAccount = document.getElementById('createAccount');
    const googleSignIn = document.getElementById('googleSignIn');

    const signedOutUI = document.getElementById('signedOutUI');
    const signedInUI = document.getElementById('signedInUI');
    const profileName = document.getElementById('profileName');
    const profileAvatar = document.getElementById('profileAvatar');
    const openProfileSettings = document.getElementById('openProfileSettings');

    const profileModal = document.getElementById('profileModal');
    const profileClose = document.getElementById('profileClose');
    const pfName = document.getElementById('pfName');
    const pfPhone = document.getElementById('pfPhone');
    const pfArea = document.getElementById('pfArea');
    const saveProfile = document.getElementById('saveProfile');
    const logoutBtn = document.getElementById('logoutBtn');

    const toCourses = document.getElementById('toCourses');
    const toProducts = document.getElementById('toProducts');

    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileNav = document.getElementById('mobileNav');
    const mobileSignIn = document.getElementById('mobileSignIn');
    const mobileSignUp = document.getElementById('mobileSignUp');

    const coursesGrid = document.getElementById('coursesGrid');
    const productsGrid = document.getElementById('productsGrid');
    const componentsGrid = document.getElementById('componentsGrid');

    const dashboardSection = document.getElementById('dashboardSection');
    const dashboardProducts = document.getElementById('dashboardProducts');
    const dashWelcome = document.getElementById('dashWelcome');
    const dashName = document.getElementById('dashName');
    const dashEmail = document.getElementById('dashEmail');
    const sessionTokenPreview = document.getElementById('sessionTokenPreview');

    const mobileAuthOpenBtn = document.getElementById('mobileSignIn');
    const mobileAuthRegisterBtn = document.getElementById('mobileSignUp');

    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    /* ====================
       INITIAL UI BEHAVIOR
       ==================== */
    // show email tab by default
    function showEmailTab(){ emailView.style.display='block'; googleView.style.display='none'; registerView.style.display='none'; tabEmail.classList.add('btn-primary'); tabGoogle.classList.remove('btn-primary'); }
    function showGoogleTab(){ emailView.style.display='none'; googleView.style.display='block'; registerView.style.display='none'; tabGoogle.classList.add('btn-primary'); tabEmail.classList.remove('btn-primary'); }
    function showRegisterView(){ emailView.style.display='none'; googleView.style.display='none'; registerView.style.display='block'; tabEmail.classList.remove('btn-primary'); tabGoogle.classList.remove('btn-primary'); }

    openAuth && openAuth.addEventListener('click', ()=>{ authModal.style.display='flex'; showEmailTab(); });
    authClose && authClose.addEventListener('click', ()=>{ authModal.style.display='none'; });

    tabEmail && tabEmail.addEventListener('click', showEmailTab);
    tabGoogle && tabGoogle.addEventListener('click', showGoogleTab);
    showRegister && showRegister.addEventListener('click', showRegisterView);
    showLogin && showLogin.addEventListener('click', showEmailTab);

    mobileAuthOpenBtn && mobileAuthOpenBtn.addEventListener('click', ()=>{ authModal.style.display='flex'; showEmailTab(); });
    mobileAuthRegisterBtn && mobileAuthRegisterBtn.addEventListener('click', ()=>{ authModal.style.display='flex'; showRegisterView(); });

    // close modals on outside click
    window.addEventListener('click', (e)=>{ if(e.target === authModal) authModal.style.display='none'; if(e.target === profileModal) profileModal.style.display='none'; });

    // password toggles
    const toggleLoginPass = document.getElementById('toggleLoginPass');
    const toggleRegPass = document.getElementById('toggleRegPass');
    toggleLoginPass && toggleLoginPass.addEventListener('click', ()=>{
      const p = document.getElementById('loginPassword');
      if(p.type === 'password'){ p.type='text'; toggleLoginPass.textContent='Hide' } else { p.type='password'; toggleLoginPass.textContent='Show' }
    });
    toggleRegPass && toggleRegPass.addEventListener('click', ()=>{
      const p = document.getElementById('regPass');
      if(p.type === 'password'){ p.type='text'; toggleRegPass.textContent='Hide' } else { p.type='password'; toggleRegPass.textContent='Show' }
    });

    /* ====================
       PARTICLES INIT (tsparticles)
       ==================== */
    window.addEventListener('load', ()=> {
      tsParticles.load("particlesCanvas", {
        fpsLimit: 60,
        particles: {
          number: { value: 60, density:{enable:true, area:800} },
          color: { value: "#56f0ff" },
          shape: { type: "circle" },
          opacity: { value: 0.09, random: true },
          size: { value: { min: 1, max: 3 } },
          links: { enable: true, distance: 140, color: "#0fbfff", opacity: 0.06, width: 1 },
          move: { enable: true, speed: 0.6, direction: "none", outMode: "out" }
        },
        interactivity: {
          detectsOn: "canvas",
          events: { onHover: { enable: true, mode: "grab" }, onClick: { enable: true, mode: "push" } },
          modes: { grab: { distance: 120, links: { opacity: 0.12 } }, push: { quantity: 3 } }
        },
        detectRetina: true,
      });
    });

    /* ====================
       Background parallax (mouse + scroll subtle)
       ==================== */
    (function backgroundParallax(){
      const bodyBefore = document.body;
      let lastX = 0, lastY = 0;
      window.addEventListener('mousemove', (e)=>{
        const cx = (e.clientX / innerWidth - 0.5) * 12; // smaller values - more subtle
        const cy = (e.clientY / innerHeight - 0.5) * 8;
        // translate background image slightly by changing transform on pseudo element - approximate by scaling body before via transform on body
        bodyBefore.style.setProperty('--mx', cx.toFixed(2));
        // apply via transform to produce parallax-like effect:
        document.body.style.setProperty('--bg-tx', `${-cx/4}px`);
        document.body.style.setProperty('--bg-ty', `${-cy/6}px`);
        document.body.style.setProperty('transform', 'none');
        // use CSS transform on pseudo by adjusting documentElement - we'll move via JS on body::before by setting style attribute via documentElement
        document.querySelector('body').style.setProperty('background-position', `calc(50% + ${-cx/6}px) calc(50% + ${-cy/10}px)`);
      });
      // small scroll parallax
      window.addEventListener('scroll', ()=>{
        const s = window.scrollY;
        const t = Math.min(60, s/6);
        document.querySelector('body').style.setProperty('filter', `brightness(${1 - Math.min(0.15, s/200)})`);
        // nudge background position
        document.querySelector('body').style.setProperty('background-position', `50% calc(50% + ${t}px)`);
      }, { passive: true });
    })();

    /* ====================
       SMOOTH SCROLL NAV LISTENERS
       ==================== */
    $$('[data-scroll]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        const id = a.getAttribute('href').slice(1);
        const el = document.getElementById(id);
        if(el){
          el.scrollIntoView({behavior:'smooth', block:'start'});
          if(mobileNav && mobileNav.classList.contains('open')){ mobileNav.classList.remove('open'); mobileMenuBtn.classList.remove('open'); }
          setTimeout(()=> el.focus({preventScroll:true}), 600);
        }
      });
    });

    // hero CTA shortcuts
    toCourses && toCourses.addEventListener('click', ()=>{ document.querySelector('a[href="#courses"]').click(); });
    toProducts && toProducts.addEventListener('click', ()=>{ document.querySelector('a[href="#products"]').click(); });

    /* ====================
       MOBILE NAV TOGGLE
       ==================== */
    mobileMenuBtn && mobileMenuBtn.addEventListener('click', ()=>{
      const open = mobileNav.classList.toggle('open');
      mobileMenuBtn.classList.toggle('open', open);
      mobileNav.setAttribute('aria-hidden', open ? 'false' : 'true');
    });

    // close mobile nav when clicking outside
    window.addEventListener('click', (e)=>{
      if(!mobileNav.contains(e.target) && !mobileMenuBtn.contains(e.target) && mobileNav.classList.contains('open')){
        mobileNav.classList.remove('open');
        mobileMenuBtn.classList.remove('open');
        mobileNav.setAttribute('aria-hidden','true');
      }
    });

    /* ====================
       Skeleton loaders -> hydrate with real cards (simulate network)
       ==================== */
    function hydrateGrids(){
      const courses = [
        {title:'Embedded Systems 101', badge:'Beginner', desc:'Learn electronics basics, microcontrollers & simple circuits — build hands-on projects.'},
        {title:'IoT for Agriculture', badge:'IoT', desc:'Smart irrigation, sensor networks & data logging — projects for small farms.'},
        {title:'Robotics & Automation', badge:'Advanced', desc:'Design, control & automate robotic arms and vehicles with microcontrollers.'}
      ];
      coursesGrid.innerHTML = courses.map(c=>`
        <article class="card" role="article">
          <span class="badge">${c.badge}</span>
          <h3>${c.title}</h3>
          <p>${c.desc}</p>
          <a href="courses.html" class="link-btn">Open Course →</a>
        </article>
      `).join('');

      const products = [
        {title:'Auto Irrigation Kit', desc:'Solar-powered controller, moisture sensor, valve driver — ready to install.', img:'https://images.unsplash.com/photo-1528825871115-3581a5387919?auto=format&fit=crop&w=1200&q=60'},
        {title:'Soil Health Sensor', desc:'pH, moisture & temperature readings with calibration and data export.', img:'https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=1200&q=60'},
        {title:'Robotics Parts Bundle', desc:'Motors, servos, frames & electronics for building small robots and arms.', img:'https://images.unsplash.com/photo-1581091870622-3c5c3f3c9f00?auto=format&fit=crop&w=1200&q=60'}
      ];
      productsGrid.innerHTML = products.map(p=>`
        <div class="card">
          <img src="${p.img}" alt="${p.title}" style="width:100%;height:160px;object-fit:cover;border-radius:8px;margin-bottom:10px">
          <h3>${p.title}</h3>
          <p>${p.desc}</p>
          <a href="products.html" class="link-btn">Shop Product →</a>
        </div>
      `).join('');

      const comps = [
        {title:'ESP32 / ESP8266 Modules', desc:'Wi-Fi + Bluetooth microcontrollers — ideal for IoT.'},
        {title:'Sensor Modules', desc:'DHT11/22, BMP180, MQ sensors & more.'},
        {title:'PCB Services', desc:'PCB review, small-batch fabrication, and assembly guidance.'}
      ];
      componentsGrid.innerHTML = comps.map(c=>`
        <div class="card"><h3>${c.title}</h3><p>${c.desc}</p><a href="componentshop.html" class="link-btn">Component Store →</a></div>
      `).join('');
    }
    // simulate network delay
    setTimeout(hydrateGrids, 900);

    /* ====================
       Session token generation (anti-scrape helper)
       ==================== */
    function generateSessionToken(){
      try{
        const arr = new Uint8Array(16);
        crypto.getRandomValues(arr);
        return Array.from(arr).map(b=>b.toString(16).padStart(2,'0')).join('');
      }catch(e){
        return Math.random().toString(36).slice(2,18);
      }
    }
    (function ensureSessionTokenForVisitor(){
      if(!localStorage.getItem('mini_session_token')){
        localStorage.setItem('mini_session_token', generateSessionToken());
      }
      setTimeout(()=>{
        const token = localStorage.getItem('mini_session_token');
        if(!token) return;
        $$('a[href]').forEach(a=>{
          try{
            const url = new URL(a.href, location.href);
            if(url.origin === location.origin){
              url.searchParams.set('_st', token);
              a.href = url.toString();
            }
          }catch(e){}
        });
      },1200);
    })();

    /* ====================
       AUTH FLOW (Email + Google, modal popup)
       ==================== */
    googleSignIn.addEventListener('click', async ()=>{
      try{
        googleSignIn.disabled = true;
        await signInWithPopup(auth, googleProvider);
        authModal.style.display = 'none';
      }catch(e){
        showToast('Google sign-in failed: ' + (e.message || e), true);
      }finally{ googleSignIn.disabled = false; }
    });

    createAccount.addEventListener('click', async ()=>{
      const name = document.getElementById('regName').value.trim();
      const phone = document.getElementById('regPhone').value.trim();
      const email = document.getElementById('regEmail').value.trim().toLowerCase();
      const pass = document.getElementById('regPass').value;
      const pass2 = document.getElementById('regPass2').value;
      if(pass.length < 6){ showToast('Password must be at least 6 characters', true); return; }
      if(pass !== pass2){ showToast('Passwords do not match', true); return; }

      createAccount.disabled = true;
      try{
        const userCred = await createUserWithEmailAndPassword(auth, email, pass);
        await updateProfile(userCred.user, { displayName: name });
        await setDoc(doc(db, 'users', userCred.user.uid), {
          name: name,
          phone: phone,
          area: '',
          email: email,
          createdAt: serverTimestamp()
        });
        authModal.style.display = 'none';
        showToast('Account created');
      }catch(e){
        showToast('Register failed: ' + (e.message || e), true);
      }finally{ createAccount.disabled = false; }
    });

    emailSignIn.addEventListener('click', async ()=>{
      const email = document.getElementById('loginEmail').value.trim().toLowerCase();
      const pass = document.getElementById('loginPassword').value;
      emailSignIn.disabled = true;
      try{
        await signInWithEmailAndPassword(auth, email, pass);
        authModal.style.display = 'none';
        showToast('Signed in');
      }catch(e){
        showToast('Sign in failed: ' + (e.message || e), true);
      }finally{ emailSignIn.disabled = false; }
    });

    // auth state observer
    let currentUser = null;
    onAuthStateChanged(auth, async (user) => {
      if(user){
        currentUser = user;
        const userDocRef = doc(db, 'users', user.uid);
        const snap = await getDoc(userDocRef);
        if(!snap.exists()){
          await setDoc(userDocRef, {
            name: user.displayName || '',
            phone: '',
            area: '',
            email: user.email || '',
            createdAt: serverTimestamp()
          });
        }
        const userData = (await getDoc(userDocRef)).data();

        signedOutUI.style.display = 'none';
        signedInUI.style.display = 'flex';
        profileName.textContent = userData.name ? userData.name.split(' ')[0] : (user.email ? user.email.split('@')[0] : 'User');
        profileAvatar.src = user.photoURL || gravatarFallback(user.email);

        pfName.value = userData.name || '';
        pfPhone.value = userData.phone || '';
        pfArea.value = userData.area || '';

        try{
          await addDoc(collection(db, 'users', user.uid, 'activity'), {
            action: 'page_view',
            page: window.location.pathname,
            ts: serverTimestamp()
          });
        }catch(e){ console.warn('Activity log failed', e); }

        // session token
        let token = localStorage.getItem('mini_session_token');
        if(!token){
          token = generateSessionToken();
          localStorage.setItem('mini_session_token', token);
        }
        try{ await updateDoc(doc(db, 'users', user.uid), { sessionToken: token, sessionTokenUpdated: serverTimestamp() }); }catch(e){}
        sessionTokenPreview.textContent = localStorage.getItem('mini_session_token') || '—';

        // show dashboard
        showDashboardForUser(userData);

      }else{
        currentUser = null;
        signedOutUI.style.display = 'flex';
        signedInUI.style.display = 'none';
        dashboardSection.style.display = 'none';
      }
    });

    // profile modal open
    openProfileSettings && openProfileSettings.addEventListener('click', ()=>{ profileModal.style.display = 'flex'; });
    profileClose && profileClose.addEventListener('click', ()=>{ profileModal.style.display = 'none'; });

    saveProfile.addEventListener('click', async ()=>{
      if(!currentUser){ showToast('No user signed in', true); return; }
      const name = pfName.value.trim();
      const phone = pfPhone.value.trim();
      const area = pfArea.value.trim();
      try{
        await updateDoc(doc(db, 'users', currentUser.uid), { name, phone, area, updatedAt: serverTimestamp() });
        await updateProfile(currentUser, { displayName: name });
        profileName.textContent = name ? name.split(' ')[0] : (currentUser.email ? currentUser.email.split('@')[0] : 'User');
        profileModal.style.display = 'none';
        await addDoc(collection(db, 'users', currentUser.uid, 'activity'), { action: 'update_profile', fields: ['name','phone','area'], ts: serverTimestamp() });
        showToast('Profile saved');
      }catch(e){
        showToast('Save failed: ' + (e.message || e), true);
      }
    });

    logoutBtn.addEventListener('click', async ()=>{
      if(!currentUser) return;
      try{
        await signOut(auth);
        profileModal.style.display = 'none';
        showToast('Signed out');
      }catch(e){
        showToast('Logout failed: ' + (e.message || e), true);
      }
    });

    // toast function
    function showToast(msg, error=false){
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      t.style.background = error ? 'linear-gradient(90deg,var(--danger),#ff3b3b)' : 'linear-gradient(90deg,var(--success),#00a0d9)';
      t.style.color = '#021';
      t.style.padding = '10px 14px';
      document.body.appendChild(t);
      setTimeout(()=>{ t.style.transition='all .45s'; t.style.opacity='0'; t.style.transform='translateY(10px)'; },2200);
      setTimeout(()=>t.remove(),2600);
    }

    // gravatar fallback (md5)
    function gravatarFallback(email){
      try{
        const hash = md5((email||'').trim().toLowerCase());
        return `https://www.gravatar.com/avatar/${hash}?d=identicon&s=80`;
      }catch(e){
        return 'file.svg';
      }
    }

    // compact md5
    function md5(s){
      function L(k,d){return (k<<d)|(k>>>(32-d))}
      function K(G,k){var I=(G&65535)+(k&65535);var H=(G>>>16)+(k>>>16)+(I>>>16);return (H<<16)|(I&65535)}
      function r(a,b,c,d,e,f,g){a=K(a,K(K((b&c)|((~b)&d),e),g));return K(L(a,f),b)}
      function o(a,b,c,d,e,f,g){a=K(a,K(K((b&d)|(c&(~d)),e),g));return K(L(a,f),b)}
      function q(a,b,c,d,e,f,g){a=K(a,K(K(b^c^d,e),g));return K(L(a,f),b)}
      function p(a,b,c,d,e,f,g){a=K(a,K(K(c^(b|(~d)),e),g));return K(L(a,f),b)}
      function s(s){var n=[],b=(1<<8)-1;for(var i=0;i<s.length*8;i+=8)n[i>>5]|=(s.charCodeAt(i/8)&b)<<(i%32);return n}
      function t(l){var a='',b=32;for(var i=0;i<4;i++)for(var j=0;j<8;j++){a+=((l>>>(i*8+j*4))&15).toString(16)}return a}
      var x=s(unescape(encodeURIComponent(s||'')));
      var a=1732584193,b=-271733879,c=-1732584194,d=271733878;
      x[x.length>>0]=x.length*8;
      for(var i=0;i<x.length;i+=16){
        var olda=a,oldb=b,oldc=c,oldd=d;
        a=r(a,b,c,d,x[i+0],7,-680876936);d=r(d,a,b,c,x[i+1],12,-389564586);
        c=r(c,d,a,b,x[i+2],17,606105819);b=r(b,c,d,a,x[i+3],22,-1044525330);
        a=r(a,b,c,d,x[i+4],7,-176418897);d=r(d,a,b,c,x[i+5],12,1200080426);
        c=r(c,d,a,b,x[i+6],17,-1473231341);b=r(b,c,d,a,x[i+7],22,-45705983);
        a=r(a,b,c,d,x[i+8],7,1770035416);d=r(d,a,b,c,x[i+9],12,-1958414417);
        c=r(c,d,a,b,x[i+10],17,-42063);b=r(b,c,d,a,x[i+11],22,-1990404162);
        a=r(a,b,c,d,x[i+12],7,1804603682);d=r(d,a,b,c,x[i+13],12,-40341101);
        c=r(c,d,a,b,x[i+14],17,-1502002290);b=r(b,c,d,a,x[i+15],22,1236535329);
        a=o(a,b,c,d,x[i+1],5,-165796510);d=o(d,a,b,c,x[i+6],9,-1069501632);
        c=o(c,d,a,b,x[i+11],14,643717713);b=o(b,c,d,a,x[i+0],20,-373897302);
        a=o(a,b,c,d,x[i+5],5,-701558691);d=o(d,a,b,c,x[i+10],9,38016083);
        c=o(c,d,a,b,x[i+15],14,-660478335);b=o(b,c,d,a,x[i+4],20,-405537848);
        a=o(a,b,c,d,x[i+9],5,568446438);d=o(d,a,b,c,x[i+14],9,-1019803690);
        c=o(c,d,a,b,x[i+3],14,-187363961);b=o(b,c,d,a,x[i+8],20,1163531501);
        a=o(a,b,c,d,x[i+13],5,-1444681467);d=o(d,a,b,c,x[i+2],9,-51403784);
        c=o(c,d,a,b,x[i+7],14,1735328473);b=o(b,c,d,a,x[i+12],20,-1926607734);
        a=q(a,b,c,d,x[i+5],4,-378558);d=q(d,a,b,c,x[i+8],11,-2022574463);
        c=q(c,d,a,b,x[i+11],16,1839030562);b=q(b,c,d,a,x[i+14],23,-35309556);
        a=q(a,b,c,d,x[i+1],4,-1530992060);d=q(d,a,b,c,x[i+4],11,1272893353);
        c=q(c,d,a,b,x[i+7],16,-155497632);b=q(b,c,d,a,x[i+10],23,-1094730640);
        a=q(a,b,c,d,x[i+13],4,681279174);d=q(d,a,b,c,x[i+0],11,-358537222);
        c=q(c,d,a,b,x[i+3],16,-722521979);b=q(b,c,d,a,x[i+6],23,76029189);
        a=q(a,b,c,d,x[i+9],4,-640364487);d=q(d,a,b,c,x[i+12],11,-421815835);
        c=q(c,d,a,b,x[i+15],16,530742520);b=q(b,c,d,a,x[i+2],23,-995338651);
        a=p(a,b,c,d,x[i+0],6,-198630844);d=p(d,a,b,c,x[i+7],10,1126891415);
        c=p(c,d,a,b,x[i+14],15,-1416354905);b=p(b,c,d,a,x[i+5],21,-57434055);
        a=p(a,b,c,d,x[i+12],6,1700485571);d=p(d,a,b,c,x[i+3],10,-1894986606);
        c=p(c,d,a,b,x[i+10],15,-1051523);b=p(b,c,d,a,x[i+1],21,-2054922799);
        a=p(a,b,c,d,x[i+8],6,1873313359);d=p(d,a,b,c,x[i+15],10,-30611744);
        c=p(c,d,a,b,x[i+6],15,-1560198380);b=p(b,c,d,a,x[i+13],21,1309151649);
        a=p(a,b,c,d,x[i+4],6,-145523070);d=p(d,a,b,c,x[i+11],10,-1120210379);
        c=p(c,d,a,b,x[i+2],15,718787259);b=p(b,c,d,a,x[i+9],21,-343485551);
        a=K(a,olda);b=K(b,oldb);c=K(c,oldc);d=K(d,oldd);
      }
      function toHex(n){return ('00000000'+(n>>>0).toString(16)).slice(-8)}
      return toHex(a)+toHex(b)+toHex(c)+toHex(d);
    }

    // show dashboard and hydrate
    function showDashboardForUser(userData){
      dashboardSection.style.display = 'block';
      dashWelcome.textContent = `Hello ${userData.name || 'Member'}, here's quick access to your products and tools.`;
      dashName.textContent = userData.name || '—';
      dashEmail.textContent = userData.email || (currentUser && currentUser.email) || '—';

      setTimeout(()=> {
        const products = [
          {title:'Auto Irrigation Kit', desc:'Solar controller, moisture sensor & valve driver', img:'https://images.unsplash.com/photo-1528825871115-3581a5387919?auto=format&fit=crop&w=1200&q=60'},
          {title:'Soil Health Sensor', desc:'pH, moisture & temperature with calibration', img:'https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=1200&q=60'},
          {title:'Robotics Parts Bundle', desc:'Motors, servos & electronics for small robots', img:'https://images.unsplash.com/photo-1581091870622-3c5c3f3c9f00?auto=format&fit=crop&w=1200&q=60'}
        ];
        dashboardProducts.innerHTML = products.map(p=>`
          <div class="product-card card">
            <img src="${p.img}" alt="${p.title}">
            <h4>${p.title}</h4>
            <p class="muted" style="font-size:13px">${p.desc}</p>
            <div style="margin-top:8px"><a href="products.html" class="link-btn">View</a></div>
          </div>
        `).join('');
      }, 600);

      const token = localStorage.getItem('mini_session_token') || '—';
      sessionTokenPreview.textContent = token;
    }

    /* ====================
       HERO ANIMATIONS (GSAP)
       ==================== */
    window.addEventListener('load', ()=>{
      // hero words timeline
      const tl = gsap.timeline({delay: .18});
      tl.from('.hero-card', {autoAlpha:0, y:30, duration:.8, ease:'power3.out'})
        .from('.hero .word', {y:20, autoAlpha:0, stagger:0.12, duration:.6, ease:'power2.out'}, '-=.4')
        .from('.hero p', {autoAlpha:0, y:8, duration:.6}, '-=.3')
        .from('.hero-actions button', {y:6, autoAlpha:0, stagger:0.08, duration:.5}, '-=.3');

      // subtle reveal for nav
      gsap.from('header.nav', {y:-10, autoAlpha:0, duration:.8, ease:'power2.out', delay:.05});
    });

    /* ====================
       Accessibility & keyboard
       ==================== */
    document.addEventListener('keydown', (e)=>{
      if(e.key === "Escape"){
        if(authModal.style.display === 'flex') authModal.style.display = 'none';
        if(profileModal.style.display === 'flex') profileModal.style.display = 'none';
        if(mobileNav.classList.contains('open')) { mobileNav.classList.remove('open'); mobileMenuBtn.classList.remove('open'); }
      }
    });

    // attach _st param check (debug)
    (function checkSessionParam(){ const p = new URLSearchParams(location.search); const st = p.get('_st'); if(st) console.log('session token param:', st); })();

  </script>
</body>
</html>
