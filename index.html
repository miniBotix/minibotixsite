<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MiniBotix</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', sans-serif;
      height: 100vh;
      overflow: hidden;
      background: url('hill.jpg') no-repeat center center fixed;
      background-size: cover;
      color: black;
    }

    /* Rainfall animation */
    .rain {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      background: url("https://i.ibb.co/ZYW3VTp/rain.gif") repeat top center;
      opacity: 0.2;
      z-index: 1;
    }

    /* Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.3);
      padding: 10px 20px;
      position: absolute;
      top: 0; width: 100%;
      z-index: 10;
    }

    .navbar img {
      height: 50px;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .nav-links a {
      text-decoration: none;
      color: black;
      font-weight: bold;
    }

    .user-icon {
      font-size: 24px;
      cursor: pointer;
    }

    /* Center Welcome Card */
    .welcome-box {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.8);
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      z-index: 2;
    }

    .welcome-box h1 {
      margin-bottom: 10px;
    }

    .welcome-box p {
      margin-bottom: 20px;
    }

    .welcome-box button {
      padding: 10px 20px;
      font-size: 16px;
      background: black;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Login Popup */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }

    .popup-content {
      background: url('jai.jpg') no-repeat center center;
      background-size: cover;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      width: 300px;
      color: white;
    }

    .popup-content input {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 8px;
      border: none;
      border-radius: 5px;
    }

    .popup-content button {
      margin-top: 10px;
      padding: 8px 16px;
      border: none;
      background: white;
      color: black;
      border-radius: 5px;
      cursor: pointer;
    }

    .mini-menu {
      position: absolute;
      top: 60px; right: 20px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      display: none;
      flex-direction: column;
      z-index: 100;
    }

    .mini-menu button {
      padding: 10px;
      background: none;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="rain"></div>

  <div class="navbar">
    <img src="file.svg" alt="Logo" />
    <div class="nav-links">
      <a href="college.html">College</a>
      <a href="about.html">About</a>
      <a href="service.html">Service</a>
      <a href="course.html">Courses</a>
      <span id="userDisplay" class="user-icon">ðŸ‘¤</span>
    </div>
  </div>

  <div class="welcome-box">
    <h1>Welcome to MiniBotix</h1>
    <p>Learn Robotics, Embedded Systems & Art-based Courses</p>
    <button onclick="location.href='course.html'">Start Learning</button>
  </div>

  <!-- Login/Register Popup -->
  <div class="popup" id="loginPopup">
    <div class="popup-content">
      <h3 id="formTitle">Login</h3>
      <input type="text" id="nameField" placeholder="Name" style="display:none;">
      <input type="email" id="emailField" placeholder="Email">
      <input type="password" id="passField" placeholder="Password">
      <input type="password" id="confirmField" placeholder="Confirm Password" style="display:none;">
      <button onclick="handleSubmit()">Submit</button>
      <p style="margin-top:10px;">
        <a href="#" onclick="toggleMode(event)">New User? Register</a>
      </p>
    </div>
  </div>

  <!-- Mini Profile Menu -->
  <div class="mini-menu" id="profileMenu">
    <button onclick="location.href='profile.html'">Profile</button>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    const popup = document.getElementById('loginPopup');
    const userIcon = document.getElementById('userDisplay');
    const profileMenu = document.getElementById('profileMenu');
    let isRegister = false;

    const emailField = document.getElementById('emailField');
    const passField = document.getElementById('passField');
    const nameField = document.getElementById('nameField');
    const confirmField = document.getElementById('confirmField');
    const formTitle = document.getElementById('formTitle');

    const scriptURL = "https://script.google.com/macros/s/AKfycbxf9xTO2V9u0hLxfWtrRPKXjubib5gS2EOvGllbUv98R_eKVhiiY4OjJmgzQST0C_b_/exec";

    // Show login popup
    userIcon.addEventListener('click', () => {
      if (localStorage.getItem("username")) {
        profileMenu.style.display = profileMenu.style.display === "flex" ? "none" : "flex";
      } else {
        popup.style.display = "flex";
      }
    });

    function toggleMode(e) {
      e.preventDefault();
      isRegister = !isRegister;
      nameField.style.display = isRegister ? "block" : "none";
      confirmField.style.display = isRegister ? "block" : "none";
      formTitle.textContent = isRegister ? "Register" : "Login";
    }

    async function handleSubmit() {
      const email = emailField.value.trim();
      const password = passField.value.trim();
      const name = nameField.value.trim();
      const confirmPass = confirmField.value.trim();

      if (!email || !password || (isRegister && (!name || password !== confirmPass))) {
        alert("Please fill all fields correctly.");
        return;
      }

      const action = isRegister ? "register" : "login";
      const body = new FormData();
      body.append("email", email);
      body.append("password", password);
      body.append("name", name);
      body.append("action", action);

      try {
        const res = await fetch(scriptURL, { method: "POST", body });
        const data = await res.json();

        if (data.status === "success") {
          localStorage.setItem("username", data.name || name);
          localStorage.setItem("email", email);
          userIcon.textContent = data.name || name;
          popup.style.display = "none";
        } else {
          alert(data.message);
        }
      } catch (err) {
        alert("Server error. Try again.");
      }
    }

    function logout() {
      localStorage.removeItem("username");
      localStorage.removeItem("email");
      userIcon.textContent = "ðŸ‘¤";
      profileMenu.style.display = "none";
    }

    // Auto-fill user on page load
    window.onload = () => {
      const name = localStorage.getItem("username");
      if (name) userIcon.textContent = name;
    };
  </script>
</body>
</html>
