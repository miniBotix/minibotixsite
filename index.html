<!DOCTYPE html>
<html>
<head>
  <title>Minibotix Login</title>
  <style>
    #loginPopup, #signupPopup {
      display: none;
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -30%);
      background: white;
      padding: 20px;
      border: 1px solid #ccc;
      z-index: 10;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9;
    }

    #topbar {
      position: fixed;
      top: 0;
      right: 0;
      padding: 10px 20px;
      background: #333;
      color: white;
    }

    button { margin: 5px; }
  </style>
</head>
<body>

<div id="topbar">
  <span id="userDisplay">üîê <button onclick="showLogin()">Login</button></span>
</div>

<div id="overlay"></div>

<div id="loginPopup">
  <h3>Login</h3>
  <input type="email" id="loginEmail" placeholder="Email"><br>
  <input type="password" id="loginPassword" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <p>New user? <a href="#" onclick="showSignup()">Sign up</a></p>
</div>

<div id="signupPopup">
  <h3>Sign Up</h3>
  <input type="text" id="signupName" placeholder="Name"><br>
  <input type="email" id="signupEmail" placeholder="Email"><br>
  <input type="password" id="signupPassword" placeholder="Password"><br>
  <button onclick="signup()">Sign Up</button>
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycby6ncZa3mxXBwSEudnPmCvJG6tAiAMVuiAol9hgljBwWFK5fGslHECoWsKp3y6LYr0W/exec";

  function showLogin() {
    document.getElementById("loginPopup").style.display = "block";
    document.getElementById("overlay").style.display = "block";
  }

  function showSignup() {
    document.getElementById("loginPopup").style.display = "none";
    document.getElementById("signupPopup").style.display = "block";
  }

  function hidePopup() {
    document.getElementById("loginPopup").style.display = "none";
    document.getElementById("signupPopup").style.display = "none";
    document.getElementById("overlay").style.display = "none";
  }

  function login() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    fetch(`${scriptURL}?action=login&email=${email}&password=${password}`)
      .then(res => res.text())
      .then(name => {
        if (name !== "INVALID") {
          document.getElementById("userDisplay").innerHTML = `üë§ ${name}`;
          hidePopup();
        } else {
          alert("Login failed. Check your email and password.");
        }
      });
  }

  function signup() {
    const name = document.getElementById("signupName").value;
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;

    fetch(`${scriptURL}?action=signup&name=${name}&email=${email}&password=${password}`)
      .then(res => res.text())
      .then(response => {
        if (response === "SUCCESS") {
          alert("Sign up successful! You can now log in.");
          hidePopup();
        } else if (response === "EMAIL_EXISTS") {
          alert("This email is already registered.");
        } else {
          alert("Signup failed. Try again.");
        }
      });
  }

  document.getElementById("overlay").onclick = hidePopup;
</script>

</body>
</html>
