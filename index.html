<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MiniBotix | Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="file.svg">
  <style>
    * { margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif }
    body,html {min-height:100%;overflow:hidden;background:url('hill.jpg') center/cover fixed;color:black;position:relative}
    /* Rain */
    .rain {position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;background-image:repeating-linear-gradient(transparent,transparent 5px,rgba(255,255,255,0.1) 6px);animation:rain .2s linear infinite;z-index:0}
    @keyframes rain{from{background-position:0 0}to{background-position:0 10px}}
    /* Top bar */
    header{position:fixed;top:0;left:0;width:100%;height:60px;background:rgba(255,255,255,0.4);backdrop-filter:blur(8px);z-index:10;display:flex;align-items:center;justify-content:space-between;padding:0 20px}
    .nav-links button{background:none;border:none;font-size:16px;color:black;font-weight:bold;cursor:pointer;margin-left:20px;transition:transform .2s}
    .nav-links button:hover{transform:scale(1.1)}
    .user-btn{background:black;color:white;padding:5px 10px;border:none;border-radius:5px;cursor:pointer;font-size:14px}
    .username{margin-left:10px;font-weight:bold;color:black}
    /* Welcome box */
    .center-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,0.9);padding:30px;border-radius:15px;width:360px;text-align:center;z-index:2;animation:fadeIn 1.5s ease-in-out}
    @keyframes fadeIn{from{opacity:0;transform:translate(-50%,-60%)}to{opacity:1;transform:translate(-50%,-50%)}}
    .center-box h1{margin-bottom:15px;font-size:24px}
    .center-box p{margin-bottom:20px;font-size:16px}
    .center-box button{padding:10px 20px;background:black;color:white;border:none;border-radius:5px;cursor:pointer;font-size:16px;transition:transform .2s}
    .center-box button:hover{transform:scale(1.05)}
    .footer{position:absolute;bottom:10px;width:100%;text-align:center;color:white;text-shadow:1px 1px 2px black;z-index:2}
    /* Popup */
    .popup-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:20}
    .popup{background:url('jai.jpg') center/cover no-repeat;padding:20px;border-radius:10px;width:320px;color:white;box-shadow:0 0 10px black}
    .popup h2{text-align:center;margin-bottom:15px}
    .popup input{width:100%;padding:8px;margin:6px 0;border-radius:5px;border:none;font-size:14px}
    .popup button{width:100%;padding:10px;background:black;color:white;border:none;border-radius:5px;margin-top:8px;cursor:pointer;font-size:16px}
    .popup .toggle{margin-top:10px;text-align:center;font-size:14px;cursor:pointer;text-decoration:underline}
    /* Profile dropdown */
    .profile-dropdown{position:absolute;top:60px;right:20px;background:white;padding:10px;border-radius:5px;box-shadow:0 2px 8px rgba(0,0,0,0.2);display:none;z-index:30}
    .profile-dropdown div{padding:8px 12px;cursor:pointer;font-size:14px;color:black}
    .profile-dropdown div:hover{background:#f0f0f0}
  </style>
</head>
<body>

  <div class="rain"></div>

  <header>
    <div class="nav-links">
      <button onclick="navigate('college.html')">College</button>
      <button onclick="navigate('about.html')">About</button>
      <button onclick="navigate('service.html')">Service</button>
      <button onclick="navigate('course.html')">Courses</button>
    </div>
    <div style="display:flex;align-items:center;">
      <button class="user-btn" id="btnLogin" onclick="showPopup()">Login</button>
      <span class="username" id="username"></span>
    </div>
  </header>

  <div class="center-box">
    <h1>Welcome to MiniBotix</h1>
    <p>Learn Robotics, Embedded Systems, and Creative Arts</p>
    <button onclick="navigate('course.html')">Start Learning</button>
  </div>

  <div class="footer">© 2025 miniBotix · Learn. Design. Innovate.</div>

  <!-- Popup -->
  <div class="popup-bg" id="popupBg">
    <div class="popup">
      <h2 id="popupTitle">Sign In</h2>
      <input type="text" id="inpName" placeholder="Name" style="display:none">
      <input type="email" id="inpEmail" placeholder="Email">
      <input type="password" id="inpPass" placeholder="Password">
      <input type="password" id="inpConfirm" placeholder="Confirm Password" style="display:none">
      <button onclick="submitPopup()">Submit</button>
      <div class="toggle" onclick="toggleMode()">New user? Register here</div>
    </div>
  </div>

  <div class="profile-dropdown" id="profileDropdown">
    <div onclick="goProfile()">Profile</div>
    <div onclick="logout()">Logout</div>
  </div>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbyHJd9ngI5saNc9wskugIVWPjgqaRBxdsltSKFAPXE_daakBNhaKwWg-w2_mP0xeT24/exec";
    let isRegister = false;

    function navigate(p){ window.location.href = p; }

    function showPopup(){
      document.getElementById("popupBg").style.display = "flex";
      isRegister = false; updatePopupMode();
    }

    function toggleMode(){
      isRegister = !isRegister; updatePopupMode();
    }

    function updatePopupMode(){
      document.getElementById("popupTitle").innerText = isRegister?"Register":"Sign In";
      document.getElementById("inpName").style.display = isRegister?"block":"none";
      document.getElementById("inpConfirm").style.display = isRegister?"block":"none";
      document.querySelector(".toggle").innerText = isRegister?"Have an account? Sign In":"New user? Register here";
    }

    async function submitPopup(){
      const name = document.getElementById("inpName").value.trim();
      const email = document.getElementById("inpEmail").value.trim();
      const pass = document.getElementById("inpPass").value;
      const confirm = document.getElementById("inpConfirm").value;

      if(!email||!pass||(isRegister&&!name)|| (isRegister && pass!==confirm)){
        return alert("Please complete the form correctly");
      }

      const payload = isRegister 
        ? { action:"register", name, email, password:pass }
        : { action:"login", email, password:pass };

      const res = await fetch(scriptUrl, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();

      if(isRegister){
        if(data.status==="exists") return alert("Email already in use");
        if(data.status==="success"){
          alert("Registered! Please sign in.");
          toggleMode();
        }
      } else {
        if(data.status==="success"){
          localStorage.setItem("username", data.name);
          localStorage.setItem("email", email);
          document.getElementById("popupBg").style.display="none";
          updateHeader();
        } else {
          alert("Invalid credentials");
        }
      }
    }

    function updateHeader(){
      const name = localStorage.getItem("username");
      if(name){
        document.getElementById("btnLogin").style.display="none";
        document.getElementById("username").innerText = name;
      }
    }

    function logout(){
      localStorage.removeItem("username");
      localStorage.removeItem("email");
      updateHeader();
      document.getElementById("profileDropdown").style.display="none";
      document.getElementById("btnLogin").style.display="inline-block";
      document.getElementById("username").innerText="";
    }

    window.onload = () => {
      updateHeader();
      document.getElementById("popupBg").addEventListener("click", e => {
        if(e.target===e.currentTarget) document.getElementById("popupBg").style.display="none";
      });
      document.getElementById("username").addEventListener("click", () => {
        document.getElementById("profileDropdown").style.display = 
          document.getElementById("profileDropdown").style.display==="block"?"none":"block";
      });
      document.addEventListener("click", e => {
        if(!e.target.closest("#profileDropdown") && e.target!==document.getElementById("username")){
          document.getElementById("profileDropdown").style.display="none";
        }
      });
    };
  </script>
</body>
</html>
